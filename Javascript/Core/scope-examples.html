<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JavaScript Scope Examples - Interactive</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-color: #1a1a1a;
        --text-color: #e0e0e0;
        --border-color: #333;
        --code-bg: #2d2d2d;
        --button-bg: #4a90e2;
        --button-hover: #357abd;
        --success-color: #28a745;
        --error-color: #dc3545;
        --warning-color: #ffc107;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 0;
        background-color: var(--bg-color);
        color: var(--text-color);
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      h1,
      h2,
      h3 {
        color: var(--text-color);
        margin-top: 2em;
        margin-bottom: 1em;
      }

      h1 {
        text-align: center;
        border-bottom: 2px solid var(--border-color);
        padding-bottom: 10px;
      }

      .example-container {
        margin: 2em 0;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        overflow: hidden;
        background-color: var(--code-bg);
      }

      .example-header {
        background-color: var(--border-color);
        padding: 10px 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid var(--border-color);
      }

      .example-title {
        font-weight: bold;
        color: var(--text-color);
      }

      .example-buttons {
        display: flex;
        gap: 10px;
      }

      .btn {
        background: var(--button-bg);
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        transition: background-color 0.2s;
      }

      .btn:hover {
        background: var(--button-hover);
      }

      .btn-clear {
        background: var(--warning-color);
      }

      .btn-clear:hover {
        background: #e0a800;
      }

      .code-editor {
        position: relative;
      }

      .code-editor textarea {
        width: 100%;
        min-height: 200px;
        background: var(--code-bg);
        color: var(--text-color);
        border: none;
        padding: 15px;
        font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
        font-size: 14px;
        resize: vertical;
        outline: none;
      }

      .code-display {
        background: var(--code-bg);
        margin: 0;
        overflow-x: auto;
      }

      .code-display code {
        display: block;
        padding: 15px;
        background: transparent;
      }

      .output-container {
        border-top: 1px solid var(--border-color);
        background-color: #1e1e1e;
        min-height: 60px;
        max-height: 300px;
        overflow-y: auto;
      }

      .output-header {
        background-color: var(--border-color);
        padding: 5px 15px;
        font-size: 12px;
        font-weight: bold;
        color: var(--text-color);
      }

      .output-content {
        padding: 10px 15px;
        font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
        font-size: 13px;
        white-space: pre-wrap;
        color: #00ff00;
      }

      .error {
        color: var(--error-color) !important;
      }

      .description {
        background-color: #2a2a2a;
        padding: 15px;
        margin: 1em 0;
        border-left: 4px solid var(--button-bg);
        border-radius: 0 4px 4px 0;
      }

      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 280px;
        height: 100vh;
        background-color: var(--code-bg);
        border-right: 2px solid var(--border-color);
        padding: 20px;
        overflow-y: auto;
        z-index: 1000;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
      }

      .sidebar h3 {
        margin-top: 0;
        margin-bottom: 20px;
        color: var(--text-color);
        font-size: 18px;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 10px;
      }

      .sidebar ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .sidebar li {
        margin: 8px 0;
      }

      .sidebar a {
        color: var(--button-bg);
        text-decoration: none;
        font-size: 14px;
        display: block;
        padding: 8px 12px;
        border-radius: 4px;
        transition: background-color 0.2s, color 0.2s;
      }

      .sidebar a:hover {
        background-color: var(--button-bg);
        color: white;
        text-decoration: none;
      }

      .main-content {
        margin-left: 300px;
        padding: 20px;
      }

      @media (max-width: 768px) {
        .sidebar {
          position: static;
          width: 100%;
          height: auto;
          border-right: none;
          border-bottom: 2px solid var(--border-color);
          box-shadow: none;
        }

        .main-content {
          margin-left: 0;
          padding: 10px;
        }

        .example-header {
          flex-direction: column;
          gap: 10px;
          align-items: flex-start;
        }
      }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <h3>Quick Navigation</h3>
      <ul>
        <li><a href="#function-scope">Function Scope</a></li>
        <li><a href="#block-scope">Block Scope</a></li>
        <li><a href="#scope-chain">Scope Chain</a></li>
        <li><a href="#common-issues">Common Issues</a></li>
        <li><a href="#practical-examples">Practical Examples</a></li>
        <li>
          <a href="#setinterval-examples">setTimeout/setInterval Issues</a>
        </li>
      </ul>
    </div>

    <div class="main-content">
      <div class="container">
        <h1>JavaScript Scope Examples - Interactive</h1>
        <div
          style="
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
          "
        >
          <a
            href="/Javascript/Core/Scope.html"
            style="
              display: inline-flex;
              align-items: center;
              color: var(--text-color);
              text-decoration: none;
              font-size: 14px;
              padding: 8px 12px;
              border-radius: 4px;
              background-color: rgba(74, 144, 226, 0.1);
              border: 1px solid var(--button-bg);
              transition: all 0.2s;
            "
            onmouseover="this.style.backgroundColor='var(--button-bg)'; this.style.color='white';"
            onmouseout="this.style.backgroundColor='rgba(74, 144, 226, 0.1)'; this.style.color='var(--text-color)';"
          >
            <span style="margin-right: 8px">←</span>
            Back to JavaScript - Scope
          </a>
        </div>
        <div
          class="security-warning"
          style="
            background-color: #2a2a2a;
            border: 2px solid var(--warning-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
          "
        >
          <h3 style="color: var(--warning-color); margin-top: 0">
            ⚠️ Security Notice
          </h3>
          <p style="margin-bottom: 0; font-size: 14px">
            This page allows you to run JavaScript code in your browser for
            educational purposes. Basic security measures are in place, but only
            run code you trust. The code executes only in your browser and
            cannot access external resources.
          </p>
        </div>

        <section id="function-scope">
          <h2>Function Scope</h2>
          <div class="description">
            Every function creates its own scope. Variables defined inside a
            function are not accessible outside.
          </div>

          <div class="example-container">
            <div class="example-header">
              <span class="example-title">Function Scope Example</span>
              <div class="example-buttons">
                <button class="btn" onclick="runCode(this)">Run</button>
                <button class="btn btn-clear" onclick="clearOutput(this)">
                  Clear
                </button>
              </div>
            </div>
            <div class="code-editor">
              <textarea>
function addFive(number) {
  const someVariable = "you can't see me outside this function";
  console.log("Inside function:", someVariable);
  return number + 5;
}

const result = addFive(10);
console.log("Result:", result);

try {
  console.log(someVariable); // This will cause an error
} catch (error) {
  console.log("Error:", error.message);
}</textarea
              >
            </div>
            <div class="output-container">
              <div class="output-header">Output:</div>
              <div class="output-content"></div>
            </div>
          </div>
        </section>

        <section id="block-scope">
          <h2>Block Scope</h2>
          <div class="description">
            Variables declared with <code>let</code> and <code>const</code> are
            confined to their block.
          </div>

          <div class="example-container">
            <div class="example-header">
              <span class="example-title">Block Scope with let</span>
              <div class="example-buttons">
                <button class="btn" onclick="runCode(this)">Run</button>
                <button class="btn btn-clear" onclick="clearOutput(this)">
                  Clear
                </button>
              </div>
            </div>
            <div class="code-editor">
              <textarea>
let friendsAtYourParty = 0;

for (let i = 0; i <= 10; i++) {
  friendsAtYourParty++;
  if (i === 5) {
    console.log("Halfway there! i =", i);
  }
}

console.log("Final count:", friendsAtYourParty);

try {
  console.log("i outside loop:", i); // This will cause an error
} catch (error) {
  console.log("Error:", error.message);
}</textarea
              >
            </div>
            <div class="output-container">
              <div class="output-header">Output:</div>
              <div class="output-content"></div>
            </div>
          </div>

          <div class="example-container">
            <div class="example-header">
              <span class="example-title">var vs let in Loops</span>
              <div class="example-buttons">
                <button class="btn" onclick="runCode(this)">Run</button>
                <button class="btn btn-clear" onclick="clearOutput(this)">
                  Clear
                </button>
              </div>
            </div>
            <div class="code-editor">
              <textarea>
console.log("=== Using var (function scope) ===");
for (var i = 0; i < 3; i++) {
  console.log("Inside loop with var:", i);
}
console.log("After loop with var:", i); // i is still accessible

console.log("\n=== Using let (block scope) ===");
for (let j = 0; j < 3; j++) {
  console.log("Inside loop with let:", j);
}

try {
  console.log("After loop with let:", j); // This will cause an error
} catch (error) {
  console.log("Error:", error.message);
}</textarea
              >
            </div>
            <div class="output-container">
              <div class="output-header">Output:</div>
              <div class="output-content"></div>
            </div>
          </div>
        </section>

        <section id="scope-chain">
          <h2>Scope Chain</h2>
          <div class="description">
            JavaScript looks for variables in this order: current scope → outer
            scope → global scope → error.
          </div>

          <div class="example-container">
            <div class="example-header">
              <span class="example-title">Scope Chain Example</span>
              <div class="example-buttons">
                <button class="btn" onclick="runCode(this)">Run</button>
                <button class="btn btn-clear" onclick="clearOutput(this)">
                  Clear
                </button>
              </div>
            </div>
            <div class="code-editor">
              <textarea>
const global = "I'm global";

function outer() {
  const outerVar = "I'm in outer";
  console.log("From outer - global:", global);
  
  function inner() {
    const innerVar = "I'm in inner";
    
    console.log("From inner - innerVar:", innerVar);   // Current scope
    console.log("From inner - outerVar:", outerVar);   // Outer scope  
    console.log("From inner - global:", global);       // Global scope
    
    try {
      console.log("From inner - notFound:", notFound); // Error
    } catch (error) {
      console.log("Error in inner:", error.message);
    }
  }
  
  inner();
  
  try {
    console.log("From outer - innerVar:", innerVar); // Error - not in scope
  } catch (error) {
    console.log("Error in outer:", error.message);
  }
}

outer();</textarea
              >
            </div>
            <div class="output-container">
              <div class="output-header">Output:</div>
              <div class="output-content"></div>
            </div>
          </div>
        </section>

        <section id="common-issues">
          <h2>Common Scope Issues</h2>

          <div class="example-container">
            <div class="example-header">
              <span class="example-title">Accidental Global Variables</span>
              <div class="example-buttons">
                <button class="btn" onclick="runCode(this)">Run</button>
                <button class="btn btn-clear" onclick="clearOutput(this)">
                  Clear
                </button>
              </div>
            </div>
            <div class="code-editor">
              <textarea>
function problematic() {
  // Forgot to declare with const/let - creates global variable!
  accidentalGlobal = "Oops! I'm global now";
  console.log("Inside function:", accidentalGlobal);
}

problematic();
console.log("Outside function:", accidentalGlobal); // This works but shouldn't!

// Better way:
function fixed() {
  const properVariable = "I'm properly scoped";
  console.log("Inside fixed function:", properVariable);
  return properVariable;
}

const result = fixed();
console.log("Returned value:", result);

try {
  console.log("Outside fixed function:", properVariable); // This will error
} catch (error) {
  console.log("Error:", error.message);
}</textarea
              >
            </div>
            <div class="output-container">
              <div class="output-header">Output:</div>
              <div class="output-content"></div>
            </div>
          </div>
        </section>

        <section id="practical-examples">
          <h2>Practical Examples</h2>

          <div class="example-container">
            <div class="example-header">
              <span class="example-title"
                >Shopping Cart with Private Variables</span
              >
              <div class="example-buttons">
                <button class="btn" onclick="runCode(this)">Run</button>
                <button class="btn btn-clear" onclick="clearOutput(this)">
                  Clear
                </button>
              </div>
            </div>
            <div class="code-editor">
              <textarea>
function createShoppingCart() {
  let items = []; // Private to this function
  let total = 0;  // Private to this function
  
  function addItem(name, price) {
    items.push({ name, price });
    total += price;
    console.log(`Added ${name} for $${price}. Total: $${total}`);
  }
  
  function getTotal() {
    return total;
  }
  
  function getItems() {
    return items.slice(); // Return a copy, not the original
  }
  
  function showCart() {
    console.log("=== Shopping Cart ===");
    items.forEach(item => console.log(`- ${item.name}: $${item.price}`));
    console.log(`Total: $${total}`);
  }
  
  // Return public interface
  return {
    add: addItem,
    total: getTotal,
    items: getItems,
    show: showCart
  };
}

const cart = createShoppingCart();
cart.add("Shirt", 25);
cart.add("Pants", 40);
cart.add("Shoes", 60);
cart.show();

console.log("\nCart total:", cart.total());

// Can't access items directly - they're private!
try {
  console.log("Direct access to items:", items);
} catch (error) {
  console.log("Error accessing private items:", error.message);
}</textarea
              >
            </div>
            <div class="output-container">
              <div class="output-header">Output:</div>
              <div class="output-content"></div>
            </div>
          </div>

          <div class="example-container">
            <div class="example-header">
              <span class="example-title">Counter with Closure</span>
              <div class="example-buttons">
                <button class="btn" onclick="runCode(this)">Run</button>
                <button class="btn btn-clear" onclick="clearOutput(this)">
                  Clear
                </button>
              </div>
            </div>
            <div class="code-editor">
              <textarea>
function createCounter(startValue = 0, step = 1) {
  let count = startValue; // Private variable
  
  function increment() {
    count += step;
    console.log(`Counter incremented to: ${count}`);
    return count;
  }
  
  function decrement() {
    count -= step;
    console.log(`Counter decremented to: ${count}`);
    return count;
  }
  
  function getValue() {
    return count;
  }
  
  function reset() {
    count = startValue;
    console.log(`Counter reset to: ${count}`);
    return count;
  }
  
  return {
    increment,
    decrement,
    value: getValue,
    reset
  };
}

const counter1 = createCounter(0, 1);
const counter2 = createCounter(100, 5);

console.log("=== Counter 1 (starts at 0, step 1) ===");
counter1.increment(); // 1
counter1.increment(); // 2
counter1.increment(); // 3

console.log("\n=== Counter 2 (starts at 100, step 5) ===");
counter2.increment(); // 105
counter2.decrement(); // 100
counter2.increment(); // 105

console.log("\n=== Independent counters ===");
console.log("Counter 1 value:", counter1.value()); // 3
console.log("Counter 2 value:", counter2.value()); // 105

counter1.reset();
console.log("Counter 1 after reset:", counter1.value()); // 0</textarea
              >
            </div>
            <div class="output-container">
              <div class="output-header">Output:</div>
              <div class="output-content"></div>
            </div>
          </div>
        </section>

        <section id="setinterval-examples">
          <h2>setTimeout/setInterval: Scope + Event Loop</h2>
          <div class="description">
            These examples demonstrate TWO fundamental concepts working
            together:
            <br /><strong>1. Scope issues</strong> - How variable capture works
            with closures <br /><strong>2. Event Loop</strong> - How
            asynchronous callbacks are executed after synchronous code
          </div>

          <div class="example-container">
            <div class="example-header">
              <span class="example-title"
                >The Classic Problem: Scope + Event Loop</span
              >
              <div class="example-buttons">
                <button class="btn" onclick="runCode(this)">Run</button>
                <button class="btn btn-clear" onclick="clearOutput(this)">
                  Clear
                </button>
              </div>
            </div>
            <div class="code-editor">
              <textarea>
console.log("=== DEMONSTRATING TWO CONCEPTS ===");
console.log("1. Scope issue (var vs let)");
console.log("2. Event Loop & Asynchronous execution");
console.log("");

console.log("🔄 SYNCHRONOUS: Starting the loop...");

for (var i = 0; i < 5; i++) {
  console.log(`🔄 SYNCHRONOUS: Loop iteration ${i}, scheduling setTimeout`);
  
  setTimeout(function() {
    console.log(`⏰ ASYNCHRONOUS: setTimeout callback executed, i = ${i}`);
  }, 100 * (i + 1));
}

console.log("🔄 SYNCHRONOUS: Loop finished! i =", i);
console.log("🔄 SYNCHRONOUS: All setTimeout calls scheduled");
console.log("");
console.log("📚 WHY 'var' CREATES THE PROBLEM:");
console.log("• 'var' has FUNCTION SCOPE, not block scope");
console.log("• This means there is only ONE 'i' variable for the entire function");
console.log("• All 5 setTimeout callbacks reference this SAME variable");
console.log("• Think of it like 5 people sharing 1 notepad");
console.log("");
console.log("📝 DETAILED STEP-BY-STEP BREAKDOWN:");
console.log("• Iteration 0: i=0, create callback that will read 'i' later");
console.log("• Iteration 1: i=1, create callback that will read 'i' later");
console.log("• Iteration 2: i=2, create callback that will read 'i' later");
console.log("• Iteration 3: i=3, create callback that will read 'i' later");
console.log("• Iteration 4: i=4, create callback that will read 'i' later");
console.log("• Loop check: i=5, condition false, exit loop");
console.log("• All callbacks execute later and find i=5 (the final value)");
console.log("");
console.log("🔍 KEY INSIGHT:");
console.log("• Callbacks don't capture the VALUE of i (0,1,2,3,4)");
console.log("• They capture a REFERENCE to the variable i");
console.log("• When they finally execute, i has changed to 5");
console.log("");
console.log("⏰ Now watch the setTimeout callbacks execute...");</textarea
              >
            </div>
            <div class="output-container">
              <div class="output-header">Output:</div>
              <div class="output-content"></div>
            </div>
          </div>

          <div class="example-container">
            <div class="example-header">
              <span class="example-title">Variable Creation: var vs let</span>
              <div class="example-buttons">
                <button class="btn" onclick="runCode(this)">Run</button>
                <button class="btn btn-clear" onclick="clearOutput(this)">
                  Clear
                </button>
              </div>
            </div>
            <div class="code-editor">
              <textarea>
console.log("=== HOW MANY VARIABLES ARE CREATED? ===");
console.log("");

console.log("🔴 WITH 'var' - Creates ONE variable:");
console.log("for (var i = 0; i < 3; i++) { ... }");
console.log("• JavaScript creates 1 variable 'i' in function scope");
console.log("• All loop iterations share this same variable");
console.log("• All callbacks reference the same memory location");
console.log("");

// Demonstrating with var
var callbacks = [];
for (var i = 0; i < 3; i++) {
  console.log(`Creating callback #${i}, current i = ${i}`);
  
  callbacks.push(function() {
    return `Callback sees i = ${i}`;
  });
}

console.log("After loop, i =", i);
console.log("Now calling all callbacks:");
callbacks.forEach((callback, index) => {
  console.log(`Callback ${index}: ${callback()}`);
});

console.log("");
console.log("🟢 WITH 'let' - Creates MULTIPLE variables:");
console.log("for (let j = 0; j < 3; j++) { ... }");
console.log("• JavaScript creates a NEW 'j' for each iteration");
console.log("• Each callback gets its own copy of the variable");
console.log("• Each callback references different memory locations");
console.log("");
console.log("🔍 WHY 'let' SOLVES THE PROBLEM:");
console.log("• 'let' has BLOCK SCOPE (limited to the { } of each iteration)");
console.log("• Each loop iteration creates a SEPARATE variable 'j'");
console.log("• Callback in iteration 0 captures j₀ = 0");
console.log("• Callback in iteration 1 captures j₁ = 1");  
console.log("• Callback in iteration 2 captures j₂ = 2");
console.log("• Think of it like each person getting their own notepad");
console.log("");

// Demonstrating with let
var letCallbacks = [];
for (let j = 0; j < 3; j++) {
  console.log(`Creating callback #${j}, current j = ${j}`);
  
  letCallbacks.push(function() {
    return `Callback sees j = ${j}`;
  });
}

console.log("After loop, j is not accessible outside");
console.log("Now calling all callbacks:");
letCallbacks.forEach((callback, index) => {
  console.log(`Callback ${index}: ${callback()}`);
});

console.log("");
console.log("🎯 THE KEY DIFFERENCE:");
console.log("• var: 1 variable shared by all callbacks → all print same value");
console.log("• let: 3 variables, each callback has its own → each prints different value");</textarea
              >
            </div>
            <div class="output-container">
              <div class="output-header">Output:</div>
              <div class="output-content"></div>
            </div>
          </div>

          <div class="example-container">
            <div class="example-header">
              <span class="example-title"
                >Visual Analogy: Shared vs Private Notepads</span
              >
              <div class="example-buttons">
                <button class="btn" onclick="runCode(this)">Run</button>
                <button class="btn btn-clear" onclick="clearOutput(this)">
                  Clear
                </button>
              </div>
            </div>
            <div class="code-editor">
              <textarea>
console.log("=== VISUAL ANALOGY: NOTEPADS ===");
console.log("");

console.log("🗒️ SCENARIO WITH 'var' (Shared Notepad):");
console.log("• There's 1 notepad in the room labeled 'i'");
console.log("• 5 people (callbacks) are told: 'remember what's on notepad i'");
console.log("• A writer quickly changes the notepad: 0 → 1 → 2 → 3 → 4 → 5");
console.log("• Later, when the 5 people check the notepad, it says '5'");
console.log("• So all 5 people report '5'");
console.log("");

// Simulating the shared notepad scenario
console.log("📝 SIMULATING SHARED NOTEPAD (var):");
var sharedNotepad = { value: "empty" };
var people = [];

for (var step = 0; step < 5; step++) {
  sharedNotepad.value = step;
  console.log(`Writer writes '${step}' on shared notepad`);
  
  people.push(function() {
    return `Person sees: '${sharedNotepad.value}' on shared notepad`;
  });
}

sharedNotepad.value = "FINAL VALUE";
console.log("Writer finishes, notepad shows: 'FINAL VALUE'");
console.log("");
console.log("Later, people check the notepad:");
people.forEach((person, index) => {
  console.log(`Person ${index}: ${person()}`);
});

console.log("");
console.log("📝 SIMULATING PRIVATE NOTEPADS (let behavior):");
var privateNotepadPeople = [];

for (let step = 0; step < 5; step++) {
  // Simulating: each person gets their own private notepad
  let privateNotepad = step;
  console.log(`Person ${step} gets private notepad with '${privateNotepad}'`);
  
  privateNotepadPeople.push(function() {
    return `Person sees: '${privateNotepad}' on their private notepad`;
  });
}

console.log("");
console.log("Later, people check their private notepads:");
privateNotepadPeople.forEach((person, index) => {
  console.log(`Person ${index}: ${person()}`);
});

console.log("");
console.log("🎯 ANALOGY SUMMARY:");
console.log("• var = Everyone shares 1 notepad → everyone sees final value");
console.log("• let = Everyone gets their own notepad → everyone keeps their value");</textarea
              >
            </div>
            <div class="output-container">
              <div class="output-header">Output:</div>
              <div class="output-content"></div>
            </div>
          </div>

          <div class="example-container">
            <div class="example-header">
              <span class="example-title">Event Loop Demonstration</span>
              <div class="example-buttons">
                <button class="btn" onclick="runCode(this)">Run</button>
                <button class="btn btn-clear" onclick="clearOutput(this)">
                  Clear
                </button>
              </div>
            </div>
            <div class="code-editor">
              <textarea>
console.log("=== EVENT LOOP ORDER OF EXECUTION ===");
console.log("");

console.log("1️⃣ SYNCHRONOUS: This runs first");

setTimeout(() => {
  console.log("4️⃣ ASYNC: setTimeout 0ms - runs after all sync code");
}, 0);

setTimeout(() => {
  console.log("5️⃣ ASYNC: setTimeout 100ms - runs after shorter delays");
}, 100);

console.log("2️⃣ SYNCHRONOUS: This runs second");

// Even with 0ms delay, setTimeout is asynchronous
setTimeout(() => {
  console.log("6️⃣ ASYNC: Another setTimeout 0ms - queued after the first one");
}, 0);

console.log("3️⃣ SYNCHRONOUS: This runs third (last sync code)");
console.log("");
console.log("📝 KEY INSIGHT:");
console.log("• ALL synchronous code runs first (1️⃣ → 2️⃣ → 3️⃣)");
console.log("• THEN asynchronous callbacks execute (4️⃣ → 5️⃣ → 6️⃣)");
console.log("• Even setTimeout(fn, 0) waits for sync code to finish!");</textarea
              >
            </div>
            <div class="output-container">
              <div class="output-header">Output:</div>
              <div class="output-content"></div>
            </div>
          </div>

          <div class="example-container">
            <div class="example-header">
              <span class="example-title"
                >Solution 1: Using let (Block Scope)</span
              >
              <div class="example-buttons">
                <button class="btn" onclick="runCode(this)">Run</button>
                <button class="btn btn-clear" onclick="clearOutput(this)">
                  Clear
                </button>
              </div>
            </div>
            <div class="code-editor">
              <textarea>
console.log("=== Solution 1: Using let ===");
console.log("This will correctly print 0,1,2,3,4");

for (let i = 0; i < 5; i++) {
  setTimeout(function() {
    console.log('Value of i with let:', i);
  }, 100 * (i + 1));
}

console.log("Why it works: 'let' creates a new binding for each iteration");
console.log("Each setTimeout callback captures its own copy of i");</textarea
              >
            </div>
            <div class="output-container">
              <div class="output-header">Output:</div>
              <div class="output-content"></div>
            </div>
          </div>

          <div class="example-container">
            <div class="example-header">
              <span class="example-title"
                >Solution 2: Using IIFE (Closure)</span
              >
              <div class="example-buttons">
                <button class="btn" onclick="runCode(this)">Run</button>
                <button class="btn btn-clear" onclick="clearOutput(this)">
                  Clear
                </button>
              </div>
            </div>
            <div class="code-editor">
              <textarea>
console.log("=== Solution 2: Using IIFE (Immediately Invoked Function Expression) ===");
console.log("This will also correctly print 0,1,2,3,4");

for (var i = 0; i < 5; i++) {
  (function(index) {
    setTimeout(function() {
      console.log('Value of index with IIFE:', index);
    }, 100 * (index + 1));
  })(i);
}

console.log("Why it works: The IIFE creates a new scope for each iteration");
console.log("The parameter 'index' captures the current value of i");</textarea
              >
            </div>
            <div class="output-container">
              <div class="output-header">Output:</div>
              <div class="output-content"></div>
            </div>
          </div>

          <div class="example-container">
            <div class="example-header">
              <span class="example-title"
                >Real setInterval Example (Auto-cleanup)</span
              >
              <div class="example-buttons">
                <button class="btn" onclick="runCode(this)">Run</button>
                <button class="btn btn-clear" onclick="clearOutput(this)">
                  Clear
                </button>
              </div>
            </div>
            <div class="code-editor">
              <textarea>
// Clear any existing intervals first
if (window.scopeIntervalIds) {
  window.scopeIntervalIds.forEach(id => clearInterval(id));
}
window.scopeIntervalIds = [];

console.log('=== Real setInterval with Scope Issues ===');
console.log('Starting intervals with var (broken):');

// Broken version with var
for (var i = 0; i < 3; i++) {
  const intervalId = setInterval(function() {
    console.log('Broken - i value:', i);
  }, 800);
  
  // Store interval ID for cleanup
  window.scopeIntervalIds.push(intervalId);
  
  // Auto-clear after 2.5 seconds
  setTimeout(() => {
    clearInterval(intervalId);
    console.log('Cleared broken interval');
  }, 2500);
}

console.log('All intervals will show i =', i, 'because var has function scope');

// Fixed version with let (starts after broken version clears)
setTimeout(() => {
  console.log('\n=== Fixed version with let ===');
  
  if (window.fixedIntervalIds) {
    window.fixedIntervalIds.forEach(id => clearInterval(id));
  }
  window.fixedIntervalIds = [];
  
  for (let j = 0; j < 3; j++) {
    const intervalId = setInterval(function() {
      console.log('Fixed - j value:', j);
    }, 800);
    
    window.fixedIntervalIds.push(intervalId);
    
    setTimeout(() => {
      clearInterval(intervalId);
      console.log('Cleared fixed interval for j =', j);
    }, 2500);
  }
}, 3000);</textarea
              >
            </div>
            <div class="output-container">
              <div class="output-header">Output:</div>
              <div class="output-content"></div>
            </div>
          </div>
        </section>

        <section id="complex-example">
          <h2>Complex Scope Example</h2>

          <div class="example-container">
            <div class="example-header">
              <span class="example-title">Multi-Scope Variable Access</span>
              <div class="example-buttons">
                <button class="btn" onclick="runCode(this)">Run</button>
                <button class="btn btn-clear" onclick="clearOutput(this)">
                  Clear
                </button>
              </div>
            </div>
            <div class="code-editor">
              <textarea>
const A = "A"; // Global scope
let F; // Global scope

function doStuff(B) {
  // B is a parameter (function scope)
  console.log("Parameter B:", B);
  const C = "C"; // Function scope
  let H = "H"; // Function scope
  
  console.log("Before if block - H:", H);
  
  if (1 + 1 === 2) {
    const D = "D"; // Block scope (inside if)
    console.log("Inside if block - D:", D);
    H = "something else"; // Modifying H from outer scope
    console.log("Inside if block - modified H:", H);
  }
  
  try {
    console.log("After if block - D:", D); // ❌ Error - D is out of scope
  } catch (error) {
    console.log("Error accessing D:", error.message);
  }
  
  console.log("After if block - H:", H); // ✅ Works - H is in function scope
  F = "F"; // Modifying global variable
}

let E = 0; // Global scope
while (E < 3) {
  E++;
  console.log("In while loop - A (global):", A);
  const G = "G"; // Block scope (inside while)
  console.log("In while loop - G (block):", G);
}

console.log("After while loop - E:", E); // ✅ Works - E is global

try {
  console.log("After while loop - G:", G); // ❌ Error - G is out of scope
} catch (error) {
  console.log("Error accessing G:", error.message);
}

console.log("\n=== Calling doStuff ===");
doStuff("Parameter Value");

console.log("\n=== Testing variable access after function call ===");

try {
  console.log("B after function:", B); // ❌ Error - B was a parameter
} catch (error) {
  console.log("Error accessing B:", error.message);
}

try {
  console.log("C after function:", C); // ❌ Error - C was in function scope
} catch (error) {
  console.log("Error accessing C:", error.message);
}

console.log("F after function:", F); // ✅ Works - F is global</textarea
              >
            </div>
            <div class="output-container">
              <div class="output-header">Output:</div>
              <div class="output-content"></div>
            </div>
          </div>
        </section>

        <!-- Variable Creation Demonstration -->
        <div class="example-container">
          <div class="example-header">
            <span class="example-title"
              >Variable Creation Count: var vs let</span
            >
            <div class="example-buttons">
              <button class="btn" onclick="runCode(this)">Run</button>
              <button class="btn btn-clear" onclick="clearOutput(this)">
                Clear
              </button>
            </div>
          </div>
          <div class="code-editor">
            <textarea>
console.log("=== VARIABLE CREATION DEMONSTRATION ===");
console.log("");

// Counter to simulate variable creation
var variableCount = 0;

console.log("🔴 WITH 'var' - FUNCTION SCOPE:");
console.log("Creating variables with 'var i'...");

function demonstrateVar() {
  // Simulate: var creates ONE variable for the entire function
  var varVariable = "var_variable_1";
  variableCount = 1;
  
  console.log(`Variables created: ${variableCount}`);
  console.log("var i: ONE variable for entire function");
  
  for (var i = 0; i < 3; i++) {
    console.log(`  Loop iteration ${i}: still using the SAME variable 'i'`);
    console.log(`  Variable count remains: ${variableCount}`);
  }
  
  console.log(`After loop: i = ${i} (same variable, modified value)`);
  console.log(`Total variables created with 'var': ${variableCount}`);
}

demonstrateVar();

console.log("");
console.log("🟢 WITH 'let' - BLOCK SCOPE:");
console.log("Creating variables with 'let i'...");

function demonstrateLet() {
  let letVariableCount = 0;
  
  for (let i = 0; i < 3; i++) {
    letVariableCount++; // Each iteration creates a new variable
    console.log(`  Loop iteration ${i}: NEW variable 'i${letVariableCount}' created`);
    console.log(`  Variable count now: ${letVariableCount}`);
  }
  
  console.log(`Total variables created with 'let': ${letVariableCount}`);
  console.log("After loop: 'i' is not accessible (block scoped)");
  
  try {
    console.log(i); // This would cause an error
  } catch(e) {
    console.log("✓ Confirmed: 'i' is not accessible outside the loop");
  }
}

demonstrateLet();

console.log("");
console.log("📊 SUMMARY:");
console.log("• var in loop: 1 variable, modified 3 times");
console.log("• let in loop: 3 variables, each with its own value");
console.log("• This is why callbacks with 'var' all see the final value");
console.log("• And callbacks with 'let' each see their captured value");</textarea
            >
          </div>
          <div class="output-container">
            <div class="output-header">Output:</div>
            <div class="output-content"></div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <script>
      // Custom console to capture output
      function createCustomConsole(outputElement) {
        const originalConsole = {
          log: console.log,
          error: console.error,
          warn: console.warn,
        };

        return {
          log: function (...args) {
            const message = args
              .map((arg) =>
                typeof arg === "object"
                  ? JSON.stringify(arg, null, 2)
                  : String(arg)
              )
              .join(" ");
            outputElement.textContent += message + "\n";
            originalConsole.log(...args);
          },
          error: function (...args) {
            const message = args.map((arg) => String(arg)).join(" ");
            const errorSpan = document.createElement("span");
            errorSpan.className = "error";
            errorSpan.textContent = "ERROR: " + message + "\n";
            outputElement.appendChild(errorSpan);
            originalConsole.error(...args);
          },
          warn: function (...args) {
            const message = args.map((arg) => String(arg)).join(" ");
            outputElement.textContent += "WARNING: " + message + "\n";
            originalConsole.warn(...args);
          },
        };
      }

      function runCode(button) {
        const container = button.closest(".example-container");
        const textarea = container.querySelector("textarea");
        const outputContent = container.querySelector(".output-content");

        // Clear previous output
        outputContent.textContent = "";

        const code = textarea.value;
        const customConsole = createCustomConsole(outputContent);

        // Basic security checks
        const dangerousPatterns = [
          /document\.cookie/i,
          /localStorage/i,
          /sessionStorage/i,
          /window\.location/i,
          /document\.write/i,
          /innerHTML/i,
          /outerHTML/i,
          /eval\s*\(/i,
          /new\s+Function/i,
          /while\s*\(\s*true/i,
          /for\s*\(\s*;\s*;\s*\)/i,
        ];

        const foundDangerous = dangerousPatterns.find((pattern) =>
          pattern.test(code)
        );
        if (foundDangerous) {
          const errorSpan = document.createElement("span");
          errorSpan.className = "error";
          errorSpan.textContent =
            "SECURITY WARNING: Potentially dangerous code detected and blocked.\n";
          outputContent.appendChild(errorSpan);
          return;
        }

        // Execution timeout to prevent infinite loops
        const timeoutId = setTimeout(() => {
          const errorSpan = document.createElement("span");
          errorSpan.className = "error";
          errorSpan.textContent =
            "TIMEOUT: Code execution took too long and was stopped.\n";
          outputContent.appendChild(errorSpan);
        }, 5000); // 5 second timeout

        try {
          // Create a restricted environment
          const restrictedEnv = {
            console: customConsole,
            setTimeout: (fn, delay) => setTimeout(fn, Math.min(delay, 5000)), // Limit delay
            setInterval: (fn, delay) => setInterval(fn, Math.max(delay, 100)), // Minimum interval
            clearTimeout: clearTimeout,
            clearInterval: clearInterval,
            Math: Math,
            Date: Date,
            JSON: JSON,
            String: String,
            Number: Number,
            Boolean: Boolean,
            Array: Array,
            Object: Object,
          };

          // Create a new function scope with restricted environment
          const func = new Function(...Object.keys(restrictedEnv), code);
          func(...Object.values(restrictedEnv));

          clearTimeout(timeoutId);
        } catch (error) {
          clearTimeout(timeoutId);
          const errorSpan = document.createElement("span");
          errorSpan.className = "error";
          errorSpan.textContent = "RUNTIME ERROR: " + error.message + "\n";
          outputContent.appendChild(errorSpan);
        }
      }

      function clearOutput(button) {
        const container = button.closest(".example-container");
        const outputContent = container.querySelector(".output-content");
        outputContent.textContent = "";
      }

      // Add syntax highlighting to textareas
      document.addEventListener("DOMContentLoaded", function () {
        // Apply syntax highlighting to all code displays
        Prism.highlightAll();

        // Add line numbers and make textareas auto-resize
        document.querySelectorAll("textarea").forEach((textarea) => {
          textarea.addEventListener("input", function () {
            this.style.height = "auto";
            this.style.height = this.scrollHeight + "px";
          });

          // Initial resize
          textarea.style.height = "auto";
          textarea.style.height = textarea.scrollHeight + "px";
        });
      });

      // Smooth scrolling for sidebar links
      document.querySelectorAll(".sidebar a").forEach((link) => {
        link.addEventListener("click", function (e) {
          e.preventDefault();
          const targetId = this.getAttribute("href").substring(1);
          const targetElement = document.getElementById(targetId);
          if (targetElement) {
            targetElement.scrollIntoView({
              behavior: "smooth",
              block: "start",
            });
          }
        });
      });
    </script>
  </body>
</html>
